<!DOCTYPE html>
<html lang="en">
<head>
<link href="https://gmpg.org/xfn/11" rel="profile">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<meta name="generator" content="Hugo 0.88.1"/>
<title>Chromium and macOS Environment Variables • htr3n&#39;s</title>
<meta name="description" content="htr3n&#39;s blog :: technology, thoughts, opinions, and rants">
<meta name="keywords" content="blog,java,php,python,golang,javascript,shell,thoughts,macos,apple,tiếng việt,parental,family,apache,httpd,laravel,politics,critical thinking,chính trị,luật,hiến pháp,xã hội,gia đình">
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Chromium and macOS Environment Variables"/>
<meta name="twitter:description" content="Trying Chromium in macOS Mojave (10.14), I confronted with the popular issue regarding Google API key missing. After obtaining an API key along with client ID and secret, I put it on some shell startup scripts as following."/>
<meta property="og:title" content="Chromium and macOS Environment Variables"/>
<meta property="og:description" content="Trying Chromium in macOS Mojave (10.14), I confronted with the popular issue regarding Google API key missing. After obtaining an API key along with client ID and secret, I put it on some shell startup scripts as following."/>
<meta property="og:type" content="article"/>
<meta property="og:url" content="https://htr3n.github.io/2019/07/chromium-macos-environment/"/><meta property="article:section" content="posts"/>
<meta property="article:published_time" content="2019-07-05T12:33:36+10:00"/>
<meta property="article:modified_time" content="2019-07-05T12:33:36+10:00"/>
<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Serif" rel="stylesheet">
<link rel="stylesheet" href="https://htr3n.github.io/scss/hyde-hyde.css">
<link rel="stylesheet" href="https://htr3n.github.io/scss/print.css" media="print">
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/favicon.png">
</head>
<body class="">
<div class="sidebar">
<div class="">
<div class="sidebar-about">
<span class="site__title">
<a href="https://htr3n.github.io/">htr3n&#39;s</a>
</span>
<div class="author-image">
<img src="https://htr3n.github.io//img/avatar.png" alt="Author Image" class="img--circle img--headshot element--center">
</div>
<p class="site__description">
</p>
</div>
<div class="collapsible-menu">
<input type="checkbox" id="menuToggle">
<label for="menuToggle">htr3n&#39;s</label>
<div class="menu-content">
<div>
<ul class="sidebar-nav">
<li>
<a href="/posts/">
<span>Posts</span>
</a>
</li>
<li>
<a href="/portfolio/">
<span>Portfolio</span>
</a>
</li>
<li>
<a href="/vn/">
<span>Tiếng Việt</span>
</a>
</li>
<li>
<a href="/about/">
<span>About</span>
</a>
</li>
</ul>
</div>
<section class="social">
<a href="https://twitter.com/htr3n" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
<a href="https://github.com/htr3n" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
<a href="https://linkedin.com/in/htr3n" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
<a href="https://stackoverflow.com/users/339302" rel="me"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
<a href="https://keybase.io/htr3n" rel="me"><i class="fab fa-keybase fa-lg" aria-hidden="true"></i></a>
<a href="mailto:hoang.huy.tran&#43;blog@gmail.com" rel="me"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
</section>
</div>
</div>
<div class="copyright">
&copy; 2021 htr3n
<a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
</div>
<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>
</div>
</div>
<div class="content container">
<article>
<header>
<h1>Chromium and macOS Environment Variables</h1>
<div class="post__meta">
<i class="fas fa-calendar-alt"></i> Jul 5, 2019 in
<a class="badge badge-category" href="/categories/macos">MACOS</a>
•
<a class="badge badge-category" href="/categories/system">SYSTEM</a>
<br/>
<i class="fas fa-tags"></i>
<a class="badge badge-tag" href="/tags/macos">macos</a>
<a class="badge badge-tag" href="/tags/chromium">chromium</a>
<a class="badge badge-tag" href="/tags/google">google</a>
<a class="badge badge-tag" href="/tags/api">api</a>
<a class="badge badge-tag" href="/tags/gui">gui</a>
<a class="badge badge-tag" href="/tags/environment-variables">environment variables</a>
<a class="badge badge-tag" href="/tags/shell">shell</a>
<br/>
<i class="fas fa-clock"></i> 3 min read
</div>
</header>
<div class="post">
<p>Trying Chromium in macOS Mojave (10.14), I confronted with the popular issue regarding <a href="https://www.google.com/search?q=chromium+google+api+key+missing">Google API key missing</a>. After obtaining an API key along with client ID and secret, I put it on some shell startup scripts as following.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">export GOOGLE_API_KEY<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;your_google_api_key&#34;</span>
export GOOGLE_DEFAULT_CLIENT_ID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;your_client_id&#34;</span>
export GOOGLE_DEFAULT_CLIENT_SECRET<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;your_client_secret&#34;</span>
</code></pre></div><p>Even more careful, I also use <code>launchctl setenv</code> to ensure these variables are available for macOS GUI applications (usually launched via Finder, Dock, Spotlight or so).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[[</span> -x /bin/launchctl <span style="color:#f92672">]]</span> <span style="color:#f92672">&amp;&amp;</span> /bin/launchctl setenv GOOGLE_API_KEY $GOOGLE_API_KEY
<span style="color:#f92672">[[</span> -x /bin/launchctl <span style="color:#f92672">]]</span> <span style="color:#f92672">&amp;&amp;</span> /bin/launchctl setenv GOOGLE_DEFAULT_CLIENT_ID $GOOGLE_DEFAULT_CLIENT_ID
<span style="color:#f92672">[[</span> -x /bin/launchctl <span style="color:#f92672">]]</span> <span style="color:#f92672">&amp;&amp;</span> /bin/launchctl setenv GOOGLE_DEFAULT_CLIENT_SECRET $GOOGLE_DEFAULT_CLIENT_SECRET
</code></pre></div><p>Sadly, it didn&rsquo;t work under Mojave. When launching Chrome from Finder or Dock, the warning is still there. It seems Apple has silently altered macOS a lot and many existing work-arounds stop working under Mojave.</p>
<p>There are also some working methods involving renaming the original executable binary <code>/Applications/Chromium.app/Contents/MacOS/Chromium</code>, creating a new script to launch Chrome in which the aforementioned variables are set properly (even leading to automated scripts like <a href="https://github.com/ezeeyahoo/ChromiumSyncEnabler">this</a>). Personally, I don&rsquo;t like these ways as they are rather intrusive and therefore less upgrade-proof (I guess future updates of Chromium will override these launching scripts and you must circumvent that) and only consider them last resort.</p>
<p>Fortunately, I have found an <a href="https://stackoverflow.com/q/25385934">old StackOverflow&rsquo;s topic</a> with two methods that work perfectly fine for macOS Mojave and systems before that as you can see in that SO&rsquo;s topic. Better then, they are much less intrusive and upgrade-friendly.</p>
<h2 id="method-1-using-login-items">Method 1: Using Login Items</h2>
<p><strong>Step 1</strong>: Open the built-in app &ldquo;Script Editor&rdquo; in <code>/Applications/Utilities/</code>, enter the following content</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-applescript" data-lang="applescript">do shell script <span style="color:#e6db74">&#34;/bin/launchctl setenv GOOGLE_API_KEY your_google_api_key&#34;</span>
do shell script <span style="color:#e6db74">&#34;/bin/launchctl setenv GOOGLE_DEFAULT_CLIENT_ID your_client_id&#34;</span>
do shell script <span style="color:#e6db74">&#34;/bin/launchctl setenv GOOGLE_DEFAULT_CLIENT_SECRET your_client_secret&#34;</span>
</code></pre></div><p>and then save (⌘ + s) under the format &ldquo;<strong>Application</strong>&rdquo;. Behind the scene, it will create a new macOS application and wraps the script content inside.</p>
<p><strong>Step 2</strong>: Go to &ldquo;Settings&rdquo; &ndash;&gt; &ldquo;Users and Groups&rdquo; &ndash;&gt; choose the tab &ldquo;Login Items&rdquo;, click + and either point to the newly created application or simply drag and drop it to the box above.</p>
<p><strong>Step 3</strong>: Log out and log in again. Chromium should see the variables and shows no warning.</p>
<h2 id="method-2-via-launchagents">Method 2: Via LaunchAgents</h2>
<p><strong>Step 1</strong>: Create a file <code>environments.plist</code> inside the folder <code>~/Library/LaunchAgents</code> with the following content:</p>
<pre tabindex="0"><code class="language-plist" data-lang="plist">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
  &lt;key&gt;Label&lt;/key&gt;
  &lt;string&gt;gui-environments&lt;/string&gt;
  &lt;key&gt;ProgramArguments&lt;/key&gt;
  &lt;array&gt;
    &lt;string&gt;sh&lt;/string&gt;
    &lt;string&gt;-c&lt;/string&gt;
    &lt;string&gt;
    /bin/launchctl setenv GOOGLE_API_KEY your_google_api_key
    /bin/launchctl setenv GOOGLE_DEFAULT_CLIENT_ID your_client_id
    /bin/launchctl setenv GOOGLE_DEFAULT_CLIENT_SECRET your_client_secret
    &lt;/string&gt;
  &lt;/array&gt;
  &lt;key&gt;RunAtLoad&lt;/key&gt;
  &lt;true/&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre><p><strong>Step 2</strong>: Enable it with <code>launchctl</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">launchctl load ~/Library/LaunchAgents/environments.plist
</code></pre></div><p><strong>Step 3</strong>: There is no step 3, just launch <code>Chromium</code> and see that it should work without warning ;)</p>
<p>In this method, you don&rsquo;t even need to log out or reboot. The variables are made available to <code>launchctl</code> after Step 2.</p>
<h2 id="conclusion">Conclusion</h2>
<p>The aforementioned methods work flawlessly under macOS Mojave (10.14) and less intrusive with respect to the target applications. As a result, we can upgrade or change the applications without concerning about re-creating, updating or changing the launching scripts. The only caveat is that, the environment variables will be exposed to all applications, and hence, could lead to some security concerns (e.g. regarding Google keys and secrets).</p>
<p>In that same SO&rsquo;s topic, there is also <a href="https://stackoverflow.com/a/26477515">a slightly different way</a> to elevate a bit more to make it work for the whole system instead of only the particular user. It involves in putting the main script where environment vars are set in <code>/etc/environment</code> and creating a launching agent in <code>/Library/LaunchAgents/</code> along with another daemon service in <code>/Library/LaunchDaemons/</code> to monitor the content of <code>/etc/environment</code>.</p>
</div>
<div class="navigation navigation-single">
<a href="/2019/06/t430s-supervisor-password-removal/" class="navigation-prev">
<i aria-hidden="true" class="fa fa-chevron-left"></i>
<span class="navigation-tittle">Lenovo Thinkpad T430s Supervisor Password Removal</span>
</a>
<a href="/2021/10/node-canvas-aws-lambda/" class="navigation-next">
<span class="navigation-tittle">Building Node Canvas Container for AWS Lambda</span>
<i aria-hidden="true" class="fa fa-chevron-right"></i>
</a>
</div>
<div class="post__related">
<h2>Related Articles</h2>
<ul class="related-posts">
<li>
<span class="list__title--small">
<a href="/2018/07/faster-zsh/">Faster and enjoyable ZSH (maybe)</a>
<time class="pull-right hidden-tablet">Jul 23, 2018</time>
</span>
</li>
<li>
<span class="list__title--small">
<a href="/2018/07/handy-quicklook/">Handy macOS QuickLook configurations</a>
<time class="pull-right hidden-tablet">Jul 30, 2018</time>
</span>
</li>
</ul>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
(function () {
    if (location.hostname === "localhost" ||
      location.hostname === "127.0.0.1" ||
      location.hostname === "") {
      return;
    }
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    var disqus_shortname = 'https-htr3n-github-io';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || 
      document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>
Please enable JavaScript to view the
<a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by
<span class="logo-disqus">Disqus</span>
</a>
</article>
</div>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-112764962-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<script defer="defer" src="https://use.fontawesome.com/releases/v5.12.1/js/all.js" integrity="sha384-ZbbbT1gw3joYkKRqh0kWyRp32UAvdqkpbLedQJSlnI8iLQcFVxaGyrOgOJiDQTTR" crossorigin="anonymous"></script>
<noscript id="deferred-styles">
<link rel="stylesheet" type="text/css" href="/css/ocean.min.css"/>
<link rel="stylesheet" type="text/css" href="/css/codecopy.min.css"/>
</noscript>
<script>
var loadDeferredStyles = function () {
    var addStylesNode = document.getElementById("deferred-styles");
    if (addStylesNode) {
      var replacement = document.createElement("div");
      replacement.innerHTML = addStylesNode.textContent;
      document.body.appendChild(replacement);
      addStylesNode.parentElement.removeChild(addStylesNode);
    }
  };
  var raf = window.requestAnimationFrame || window.mozRequestAnimationFrame ||
    window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
  if (raf) raf(function () {
    window.setTimeout(loadDeferredStyles, 0);
  });
  else
    window.addEventListener('load', loadDeferredStyles);
  
  document.addEventListener('DOMContentLoaded', function (event) {
    codecopy('pre');
  });
</script>
<script defer="defer" src="/js/codecopy.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/sh.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/applescript.min.js"></script>
<script type="text/javascript">
hljs.configure({languages: ["sh, applescript"]});
        
        hljs.initHighlightingOnLoad();
</script>
</body>
</html>
